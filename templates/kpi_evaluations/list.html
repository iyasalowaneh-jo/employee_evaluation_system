{% extends "base.html" %}

{% block title %}KPI Evaluations - Employee Evaluation System{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <h2 class="mb-4"><i class="fas fa-chart-line"></i> KPI Evaluations</h2>

    {% if cycle and not (cycle.include_kpi | default(true)) %}
    <div class="alert alert-warning mb-4">
        <i class="fas fa-exclamation-triangle"></i> <strong>This evaluation round ({{ cycle.name }}) does not include KPI evaluations.</strong> 
        Only 360-degree feedback is part of this round. KPI evaluations will be available in rounds that include KPIs.
    </div>
    {% endif %}
    
    <div class="alert alert-info">
        <i class="fas fa-info-circle"></i> <strong>KPI Evaluation Policy:</strong> 
        KPIs are evaluated exclusively by designated managerial roles according to the organizational hierarchy 
        and are subject to review and approval by higher management.
    </div>
    
    <div class="card">
        <div class="card-header">
            <h5>Employees You Can Evaluate - {{ cycle.name }}</h5>
        </div>
        <div class="card-body">
            {% if evaluations %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Department</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for eval_data in evaluations %}
                        <tr>
                            <td><strong>{{ eval_data.employee.full_name }}</strong></td>
                            <td>{{ eval_data.employee.department }}</td>
                            <td>{{ eval_data.employee.role }}</td>
                            <td>
                                {% if eval_data.status == 'not_started' %}
                                    <span class="badge bg-secondary">Not Started</span>
                                {% elif eval_data.status == 'draft' %}
                                    <span class="badge bg-warning">Draft</span>
                                {% elif eval_data.status == 'pending_review' %}
                                    <span class="badge bg-info">Pending Review</span>
                                {% elif eval_data.status == 'approved' %}
                                    <span class="badge bg-success">Approved</span>
                                {% elif eval_data.status == 'final' %}
                                    <span class="badge bg-primary">Final</span>
                                {% else %}
                                    <span class="badge bg-secondary">{{ eval_data.status }}</span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{{ url_for('submit_kpi_evaluation', cycle_id=cycle.cycle_id, evaluatee_id=eval_data.employee.employee_id) }}" 
                                   class="btn btn-sm btn-{{ 'primary' if eval_data.status == 'not_started' else 'warning' }}">
                                    <i class="fas fa-{{ 'edit' if eval_data.evaluation else 'pencil-alt' }}"></i> 
                                    {{ 'Edit' if eval_data.evaluation else 'Evaluate' }}
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle"></i> No employees assigned for KPI evaluation.
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="mt-3">
        <a href="{{ url_for('kpi_results') }}" class="btn btn-secondary">
            <i class="fas fa-chart-bar"></i> View KPI Results
        </a>
    </div>
</div>
{% endblock %}
